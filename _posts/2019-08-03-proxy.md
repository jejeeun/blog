---
title: Redis ë‹¨ì¼ ì˜ì¡´ íƒˆí”¼ë¥¼ ìœ„í•œ í”„ë¡ì‹œ íŒ¨í„´ ë„ì…ê¸° - B2B ê³ ê°ì‚¬ë³„ ìºì‹œ ì—”ì§„ ìš”êµ¬ì‚¬í•­ ëŒ€ì‘
date: 2025-07-13 10:00:00 +0900
categories: [Backend, Design-Pattern]
tags: [redis, proxy-pattern, spring-boot, b2b, architecture]
---

## í•µì‹¬ ìš”ì•½

B2B ì„œë¹„ìŠ¤ì—ì„œ ê³ ê°ì‚¬ë³„ë¡œ ë‹¤ë¥¸ ìºì‹œ ì—”ì§„ ìš”êµ¬ì‚¬í•­(Redis ì „ìš©, Hazelcast ì„ í˜¸, í´ëŸ¬ìŠ¤í„° ì œì•½ ë“±)ì— ëŒ€ì‘í•˜ê¸° ìœ„í•´ í”„ë¡ì‹œ íŒ¨í„´ì„ ë„ì…í–ˆìŠµë‹ˆë‹¤. CacheProxyë¥¼ í†µí•´ ì„¤ì • ë³€ê²½ë§Œìœ¼ë¡œ ìºì‹œ ì—”ì§„ì„ ëŸ°íƒ€ì„ì— ì „í™˜í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¥¼ êµ¬ì¶•í•˜ì—¬, ì†ŒìŠ¤ ì½”ë“œ ë³€ê²½ ì—†ì´ ë‹¤ì–‘í•œ ê³ ê°ì‚¬ í™˜ê²½ì— ìœ ì—°í•˜ê²Œ ëŒ€ì‘í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

## âš ï¸ ë¬¸ì œ ìƒí™©

### ì´ˆê¸° Redis ì§ì ‘ ì˜ì¡´ êµ¬ì¡°

```java
// ë¬¸ì œê°€ ëœ ì´ˆê¸° ì½”ë“œ - Redis ì§ì ‘ ì˜ì¡´
@Service
public class ProductService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate; // Redis ê°•ê²°í•©
    
    public Product getProduct(String productId) {
        // Lettuce ì§ì ‘ ì‚¬ìš©ìœ¼ë¡œ Redisì— ì¢…ì†
        String key = "product:" + productId;
        Product cached = (Product) redisTemplate.opsForValue().get(key);
        
        if (cached != null) {
            return cached;
        }
        
        Product product = productRepository.findById(productId);
        redisTemplate.opsForValue().set(key, product, Duration.ofHours(1));
        return product;
    }
}
```

### B2B ê³ ê°ì‚¬ë³„ ìš”êµ¬ì‚¬í•­

```yaml
# ê³ ê°ì‚¬ A: Redis í´ëŸ¬ìŠ¤í„°ë§Œ í—ˆìš©
customer-a:
  cache:
    type: redis-cluster
    security: high
    
# ê³ ê°ì‚¬ B: Hazelcast ì„ í˜¸ (ê¸°ì¡´ ì¸í”„ë¼ì™€ í†µí•©)
customer-b:
  cache:
    type: hazelcast
    integration: existing-infrastructure
    
# ê³ ê°ì‚¬ C: ë‹¨ì¼ ë…¸ë“œ ì œì•½ (ë¹„ìš© ìµœì í™”)
customer-c:
  cache:
    type: redis-standalone
    nodes: single
```

**í•µì‹¬ ë¬¸ì œì :**
- **ê³ ê°ì‚¬ë³„ ë°°í¬ ë¶ˆê°€**: ì„œë¡œ ë‹¤ë¥¸ ìºì‹œ ì—”ì§„ ìš”êµ¬ì‚¬í•­
- **ì½”ë“œ ì¤‘ë³µ**: ê³ ê°ì‚¬ë³„ë¡œ ë‹¤ë¥¸ ìºì‹œ ë¡œì§ êµ¬í˜„ í•„ìš”
- **ìœ ì§€ë³´ìˆ˜ ë³µì¡ë„**: ìºì‹œ ì—”ì§„ ë³€ê²½ ì‹œ ì „ì²´ ì½”ë“œ ìˆ˜ì •

## ğŸ” ë¬¸ì œ ë¶„ì„

### 1. ë©€í‹°ëª¨ë“ˆ ì•„í‚¤í…ì²˜ ìš”êµ¬ì‚¬í•­

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User Service  â”‚    â”‚ Product Service â”‚    â”‚  Order Service  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Cache Layer       â”‚  â† í†µì¼ëœ API í•„ìš”
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Redis / Hazelcast   â”‚  â† ëŸ°íƒ€ì„ ì„ íƒ
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Spring ë¹ˆ ì£¼ì… ì‹œì  í™œìš©

```java
// ë¶„ì„: Configurationì—ì„œ ìºì‹œ íƒ€ì… ê²°ì •
@Configuration
public class CacheConfiguration {
    
    @Value("${cache.type:redis}")
    private String cacheType;
    
    // ëŸ°íƒ€ì„ì— êµ¬í˜„ì²´ ì„ íƒ ê°€ëŠ¥
    @Bean
    public CacheRepository cacheRepository() {
        return switch (cacheType) {
            case "redis" -> new RedisCacheRepository();
            case "hazelcast" -> new HazelcastCacheRepository();
            default -> throw new IllegalArgumentException("Unknown cache type: " + cacheType);
        };
    }
}
```

## âœ… í•´ê²° ë°©ì•ˆ

### 1. ê³µí†µ ì¸í„°í˜ì´ìŠ¤ ì„¤ê³„

```java
/**
 * ìºì‹œ ì €ì¥ì†Œ ê³µí†µ ì¸í„°í˜ì´ìŠ¤
 * - ìºì‹œ ì—”ì§„ì— ë…ë¦½ì ì¸ ì¶”ìƒí™”
 */
public interface CacheRepository<K, V> {
    Optional<V> get(K key);
    void put(K key, V value, Duration ttl);
    void evict(K key);
    void clear();
    boolean exists(K key);
}

/**
 * ìºì‹œ ì„œë¹„ìŠ¤ ê³µí†µ ì¸í„°í˜ì´ìŠ¤
 * - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë ˆë²¨ ì¶”ìƒí™”
 */
public interface CacheService<K, V> {
    Optional<V> getFromCache(K key);
    void putToCache(K key, V value, Duration ttl);
    void invalidateCache(K key);
    void invalidatePattern(String pattern);
}
```

### 2. CacheProxy êµ¬í˜„

```java
/**
 * ìºì‹œ í”„ë¡ì‹œ - ëŸ°íƒ€ì„ êµ¬í˜„ì²´ ì„ íƒ
 * Proxy Pattern ì ìš©
 */
@Component
@Slf4j
public class CacheProxy<K, V> implements CacheRepository<K, V> {
    
    private final CacheRepository<K, V> delegateRepository;
    private final String cacheType;
    
    public CacheProxy(@Value("${cache.type:redis}") String cacheType,
                     ApplicationContext context) {
        this.cacheType = cacheType;
        this.delegateRepository = resolveCacheRepository(cacheType, context);
        
        log.info("Cache proxy initialized with type: {}", cacheType);
    }
    
    @Override
    public Optional<V> get(K key) {
        try {
            return delegateRepository.get(key);
        } catch (Exception e) {
            log.error("Cache get failed for key: {}, type: {}", key, cacheType, e);
            return Optional.empty();
        }
    }
    
    @Override
    public void put(K key, V value, Duration ttl) {
        try {
            delegateRepository.put(key, value, ttl);
            log.debug("Cache put successful - key: {}, type: {}", key, cacheType);
        } catch (Exception e) {
            log.error("Cache put failed for key: {}, type: {}", key, cacheType, e);
        }
    }
    
    @Override
    public void evict(K key) {
        try {
            delegateRepository.evict(key);
        } catch (Exception e) {
            log.error("Cache evict failed for key: {}, type: {}", key, cacheType, e);
        }
    }
    
    @Override
    public void clear() {
        try {
            delegateRepository.clear();
        } catch (Exception e) {
            log.error("Cache clear failed for type: {}", cacheType, e);
        }
    }
    
    @Override
    public boolean exists(K key) {
        try {
            return delegateRepository.exists(key);
        } catch (Exception e) {
            log.error("Cache exists check failed for key: {}, type: {}", key, cacheType, e);
            return false;
        }
    }
    
    private CacheRepository<K, V> resolveCacheRepository(String cacheType, 
                                                        ApplicationContext context) {
        return switch (cacheType.toLowerCase()) {
            case "redis" -> context.getBean("redisCacheRepository", CacheRepository.class);
            case "hazelcast" -> context.getBean("hazelcastCacheRepository", CacheRepository.class);
            case "local" -> context.getBean("localCacheRepository", CacheRepository.class);
            default -> throw new IllegalArgumentException("Unsupported cache type: " + cacheType);
        };
    }
}
```

### 3. Redis êµ¬í˜„ì²´

```java
/**
 * Redis ìºì‹œ ì €ì¥ì†Œ êµ¬í˜„
 */
@Repository("redisCacheRepository")
@Slf4j
public class RedisCacheRepository<K, V> implements CacheRepository<K, V> {
    
    private final RedisTemplate<String, Object> redisTemplate;
    private final ObjectMapper objectMapper;
    
    public RedisCacheRepository(RedisTemplate<String, Object> redisTemplate) {
        this.redisTemplate = redisTemplate;
        this.objectMapper = new ObjectMapper()
                .registerModule(new JavaTimeModule());
    }
    
    @Override
    public Optional<V> get(K key) {
        try {
            String redisKey = convertKey(key);
            Object cached = redisTemplate.opsForValue().get(redisKey);
            
            if (cached == null) {
                return Optional.empty();
            }
            
            // JSON ì—­ì§ë ¬í™”
            V value = deserializeValue(cached.toString());
            return Optional.of(value);
            
        } catch (Exception e) {
            log.error("Redis get operation failed", e);
            return Optional.empty();
        }
    }
    
    @Override
    public void put(K key, V value, Duration ttl) {
        try {
            String redisKey = convertKey(key);
            String jsonValue = objectMapper.writeValueAsString(value);
            
            if (ttl != null && !ttl.isZero()) {
                redisTemplate.opsForValue().set(redisKey, jsonValue, ttl);
            } else {
                redisTemplate.opsForValue().set(redisKey, jsonValue);
            }
            
        } catch (Exception e) {
            log.error("Redis put operation failed", e);
        }
    }
    
    @Override
    public void evict(K key) {
        try {
            String redisKey = convertKey(key);
            redisTemplate.delete(redisKey);
        } catch (Exception e) {
            log.error("Redis evict operation failed", e);
        }
    }
    
    @Override
    public void clear() {
        try {
            // íŒ¨í„´ ê¸°ë°˜ ì‚­ì œ (ì£¼ì˜: ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ì„±ëŠ¥ ê³ ë ¤ í•„ìš”)
            Set<String> keys = redisTemplate.keys("cache:*");
            if (keys != null && !keys.isEmpty()) {
                redisTemplate.delete(keys);
            }
        } catch (Exception e) {
            log.error("Redis clear operation failed", e);
        }
    }
    
    @Override
    public boolean exists(K key) {
        try {
            String redisKey = convertKey(key);
            return Boolean.TRUE.equals(redisTemplate.hasKey(redisKey));
        } catch (Exception e) {
            log.error("Redis exists check failed", e);
            return false;
        }
    }
    
    private String convertKey(K key) {
        return "cache:" + key.toString();
    }
    
    @SuppressWarnings("unchecked")
    private V deserializeValue(String jsonValue) throws Exception {
        // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” íƒ€ì… ì •ë³´ë¥¼ í™œìš©í•œ ì—­ì§ë ¬í™”
        return (V) objectMapper.readValue(jsonValue, Object.class);
    }
}
```

### 4. Hazelcast êµ¬í˜„ì²´

```java
/**
 * Hazelcast ìºì‹œ ì €ì¥ì†Œ êµ¬í˜„
 */
@Repository("hazelcastCacheRepository")
@Slf4j
public class HazelcastCacheRepository<K, V> implements CacheRepository<K, V> {
    
    private final HazelcastInstance hazelcastInstance;
    private final IMap<String, Object> cacheMap;
    
    public HazelcastCacheRepository(HazelcastInstance hazelcastInstance) {
        this.hazelcastInstance = hazelcastInstance;
        this.cacheMap = hazelcastInstance.getMap("default-cache");
    }
    
    @Override
    public Optional<V> get(K key) {
        try {
            String mapKey = convertKey(key);
            Object cached = cacheMap.get(mapKey);
            
            if (cached == null) {
                return Optional.empty();
            }
            
            @SuppressWarnings("unchecked")
            V value = (V) cached;
            return Optional.of(value);
            
        } catch (Exception e) {
            log.error("Hazelcast get operation failed", e);
            return Optional.empty();
        }
    }
    
    @Override
    public void put(K key, V value, Duration ttl) {
        try {
            String mapKey = convertKey(key);
            
            if (ttl != null && !ttl.isZero()) {
                cacheMap.put(mapKey, value, ttl.getSeconds(), TimeUnit.SECONDS);
            } else {
                cacheMap.put(mapKey, value);
            }
            
        } catch (Exception e) {
            log.error("Hazelcast put operation failed", e);
        }
    }
    
    @Override
    public void evict(K key) {
        try {
            String mapKey = convertKey(key);
            cacheMap.remove(mapKey);
        } catch (Exception e) {
            log.error("Hazelcast evict operation failed", e);
        }
    }
    
    @Override
    public void clear() {
        try {
            cacheMap.clear();
        } catch (Exception e) {
            log.error("Hazelcast clear operation failed", e);
        }
    }
    
    @Override
    public boolean exists(K key) {
        try {
            String mapKey = convertKey(key);
            return cacheMap.containsKey(mapKey);
        } catch (Exception e) {
            log.error("Hazelcast exists check failed", e);
            return false;
        }
    }
    
    private String convertKey(K key) {
        return "cache:" + key.toString();
    }
}
```

### 5. ì„¤ì • ê¸°ë°˜ ìºì‹œ ì „í™˜

```yaml
# application-redis.yml
cache:
  type: redis
  
spring:
  data:
    redis:
      host: localhost
      port: 6379
      
---
# application-hazelcast.yml  
cache:
  type: hazelcast
  
hazelcast:
  cluster-name: dev-cluster
  members: localhost:5701
```

### 6. ê°œì„ ëœ ì„œë¹„ìŠ¤ ë ˆì´ì–´

```java
/**
 * ê°œì„ ëœ ProductService - ìºì‹œ ì—”ì§„ì— ë…ë¦½ì 
 */
@Service
@Slf4j
public class ProductService {
    
    private final CacheRepository<String, Product> cacheRepository;
    private final ProductRepository productRepository;
    
    // ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´, êµ¬í˜„ì²´ëŠ” ëŸ°íƒ€ì„ì— ì£¼ì…
    public ProductService(CacheRepository<String, Product> cacheRepository,
                         ProductRepository productRepository) {
        this.cacheRepository = cacheRepository;
        this.productRepository = productRepository;
    }
    
    public Product getProduct(String productId) {
        String cacheKey = "product:" + productId;
        
        // ìºì‹œ ì—”ì§„ì— ê´€ê³„ì—†ì´ ë™ì¼í•œ API ì‚¬ìš©
        Optional<Product> cached = cacheRepository.get(cacheKey);
        if (cached.isPresent()) {
            log.debug("Cache hit for product: {}", productId);
            return cached.get();
        }
        
        // DB ì¡°íšŒ
        Product product = productRepository.findById(productId)
                .orElseThrow(() -> new EntityNotFoundException("Product not found: " + productId));
        
        // ìºì‹œ ì €ì¥ (1ì‹œê°„ TTL)
        cacheRepository.put(cacheKey, product, Duration.ofHours(1));
        
        log.info("Product loaded from DB and cached: {}", productId);
        return product;
    }
    
    public void updateProduct(Product product) {
        // DB ì—…ë°ì´íŠ¸
        productRepository.save(product);
        
        // ìºì‹œ ë¬´íš¨í™”
        String cacheKey = "product:" + product.getProductId();
        cacheRepository.evict(cacheKey);
        
        log.info("Product updated and cache invalidated: {}", product.getProductId());
    }
}
```

## ğŸ“Š ì„±ê³¼ ë° íš¨ê³¼

### ìºì‹œ ì—”ì§„ ì „í™˜ í…ŒìŠ¤íŠ¸

```java
@SpringBootTest
class CacheProxyIntegrationTest {
    
    @Autowired
    private CacheRepository<String, String> cacheRepository;
    
    @Test
    @TestPropertySource(properties = "cache.type=redis")
    void testRedisCache() {
        // Redis ìºì‹œ í…ŒìŠ¤íŠ¸
        String key = "test:redis";
        String value = "redis-value";
        
        cacheRepository.put(key, value, Duration.ofMinutes(1));
        Optional<String> result = cacheRepository.get(key);
        
        assertThat(result).isPresent();
        assertThat(result.get()).isEqualTo(value);
    }
    
    @Test  
    @TestPropertySource(properties = "cache.type=hazelcast")
    void testHazelcastCache() {
        // Hazelcast ìºì‹œ í…ŒìŠ¤íŠ¸
        String key = "test:hazelcast";
        String value = "hazelcast-value";
        
        cacheRepository.put(key, value, Duration.ofMinutes(1));
        Optional<String> result = cacheRepository.get(key);
        
        assertThat(result).isPresent();
        assertThat(result.get()).isEqualTo(value);
    }
}
```

### ê³ ê°ì‚¬ë³„ ë°°í¬ ì„±ê³µ

```bash
# ê³ ê°ì‚¬ A: Redis ë°°í¬
docker run -e SPRING_PROFILES_ACTIVE=redis app:latest

# ê³ ê°ì‚¬ B: Hazelcast ë°°í¬  
docker run -e SPRING_PROFILES_ACTIVE=hazelcast app:latest

# ë™ì¼í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°”ì´ë„ˆë¦¬ë¡œ ë‹¤ë¥¸ ìºì‹œ ì—”ì§„ ì‚¬ìš©
```

## í•µì‹¬ ì„±ê³¼

1. **ì½”ë“œ ë³€ê²½ ì—†ëŠ” ìºì‹œ ì „í™˜**: application.yml í•œ ì¤„ë¡œ Redis â†” Hazelcast ì „í™˜
2. **ê³ ê°ì‚¬ë³„ ìœ ì—°í•œ ëŒ€ì‘**: ë™ì¼í•œ ë°”ì´ë„ˆë¦¬ë¡œ ë‹¤ì–‘í•œ ìºì‹œ í™˜ê²½ ì§€ì›
3. **ê°œë°œ ìƒì‚°ì„± í–¥ìƒ**: ìºì‹œ ë¡œì§ ì¶”ìƒí™”ë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì§‘ì¤‘
4. **ìœ ì§€ë³´ìˆ˜ì„± ê°œì„ **: ìƒˆë¡œìš´ ìºì‹œ ì—”ì§„ ì¶”ê°€ ì‹œ êµ¬í˜„ì²´ë§Œ ì¶”ê°€í•˜ë©´ ë¨

í”„ë¡ì‹œ íŒ¨í„´ ë„ì…ì„ í†µí•´ B2B ì„œë¹„ìŠ¤ì˜ ë³µì¡í•œ ê³ ê°ì‚¬ ìš”êµ¬ì‚¬í•­ì— ìœ ì—°í•˜ê²Œ ëŒ€ì‘í•  ìˆ˜ ìˆëŠ” í™•ì¥ ê°€ëŠ¥í•œ ìºì‹œ ì•„í‚¤í…ì²˜ë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

---

*ë³¸ ê¸€ì€ ì‹¤ì œ B2B ì„œë¹„ìŠ¤ ê°œë°œ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìœ¼ë©°, í”„ë¡ì‹œ íŒ¨í„´ì˜ ì‹¤ë¬´ ì ìš© ì‚¬ë¡€ë¥¼ ì†Œê°œí•©ë‹ˆë‹¤.*