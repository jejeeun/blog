---
title: "Spring Boot ë©€í‹°ëª¨ë“ˆì—ì„œ ìºì‹œ ì—”ì§„ ì¶”ìƒí™” ë ˆì´ì–´ êµ¬ì¶• - 1ë¶€: ê¸°ë³¸ ì„¤ê³„ì™€ íŒ©í† ë¦¬/í”„ë¡ì‹œ íŒ¨í„´ ì ìš©"
date: 2024-02-28 10:00:00 +0900
categories: [Backend, Architecture]
tags: [spring-boot, cache, redis, hazelcast, proxy-pattern, multimodule, reactive]
---

## í•µì‹¬ ìš”ì•½

Spring Boot ë©€í‹°ëª¨ë“ˆ í™˜ê²½ì—ì„œ ë‹¤ì–‘í•œ ìºì‹œ ì—”ì§„(Redis, Hazelcast)ì„ í•˜ë‚˜ì˜ ì¸í„°í˜ì´ìŠ¤ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ íŒ©í† ë¦¬ íŒ¨í„´ê³¼ í”„ë¡ì‹œ íŒ¨í„´ì„ í™œìš©í•œ ìºì‹œ ì¶”ìƒí™” ë ˆì´ì–´ë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. ì„¤ì • íŒŒì¼ë§Œ ìˆ˜ì •í•˜ë©´ ìºì‹œ ì—”ì§„ì„ ì „í™˜í•  ìˆ˜ ìˆì–´ ìœ ì—°í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ ìºì‹œ ì‹œìŠ¤í…œì˜ ê¸°ì´ˆë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

## ë¬¸ì œ ìƒí™©

### ë©€í‹°ëª¨ë“ˆ í”„ë¡œì íŠ¸ì˜ ìºì‹œ ë¬¸ì œ

ì—¬ëŸ¬ ëª¨ë“ˆì—ì„œ ê°ê° ë‹¤ë¥¸ ìºì‹œ ìš”êµ¬ì‚¬í•­ì„ ê°€ì§€ëŠ” ìƒí™©:

```
boot-master/
â”œâ”€â”€ authorization-service/     # ì¸ì¦/ì¸ê°€ ëª¨ë“ˆ
â”œâ”€â”€ gateway-service/           # API ê²Œì´íŠ¸ì›¨ì´ ëª¨ë“ˆ
â”œâ”€â”€ admin-service/             # ê´€ë¦¬ ëª¨ë“ˆ
â”œâ”€â”€ cache-service/             # ë™ê¸° ìºì‹œ ëª¨ë“ˆ
â”œâ”€â”€ cache-reactive-service/    # ë¹„ë™ê¸° ìºì‹œ ëª¨ë“ˆ
â””â”€â”€ boot-common/               # ê³µí†µ ëª¨ë“ˆ
```

### ê¸°ì¡´ ìºì‹œ êµ¬ì¡°ì˜ ë¬¸ì œì 

```java
// ê¸°ì¡´ ë°©ì‹ - ê° ì„œë¹„ìŠ¤ë§ˆë‹¤ ìºì‹œ ì—”ì§„ ì§ì ‘ ì‚¬ìš©
@Service
public class UserService {
    @Autowired
    private RedisTemplate<String, User> redisTemplate; // Redis ì§ì ‘ ì˜ì¡´
    
    public User getUser(String userId) {
        User user = redisTemplate.opsForValue().get("user:" + userId);
        if (user == null) {
            user = userRepository.findById(userId);
            redisTemplate.opsForValue().set("user:" + userId, user);
        }
        return user;
    }
}
```

**ì£¼ìš” ë¬¸ì œì :**
- **ìºì‹œ ì—”ì§„ ë³€ê²½ ì–´ë ¤ì›€**: Redis â†’ Hazelcast ì „í™˜ ì‹œ ëª¨ë“  ì„œë¹„ìŠ¤ ì½”ë“œ ìˆ˜ì • í•„ìš”
- **ì½”ë“œ ì¤‘ë³µ**: ê° ì„œë¹„ìŠ¤ë§ˆë‹¤ ë¹„ìŠ·í•œ ìºì‹œ ë¡œì§ ë°˜ë³µ
- **í…ŒìŠ¤íŠ¸ ë³µì¡ì„±**: ìºì‹œ ì—”ì§„ ì˜ì¡´ì„± ë•Œë¬¸ì— ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± ì–´ë ¤ì›€

## í•´ê²° ë°©ì•ˆ ì„¤ê³„

### 1. ìºì‹œ ì—”ì§„ ì„ íƒ ë¡œì§

```java
public enum CacheType {
    REDIS("redis"),
    HAZELCAST("hazelcast"), 
    MULTI_LEVEL("multi");
    
    private final String value;
    
    CacheType(String value) {
        this.value = value;
    }
    
    public static CacheType fromValue(String value) {
        for (CacheType type : values()) {
            if (type.value.equals(value)) {
                return type;
            }
        }
        throw new IllegalArgumentException("Unknown cache type: " + value);
    }
}
```

### 2. ìºì‹œ íŒ©í† ë¦¬ êµ¬í˜„

```java
@Component
public class CacheFactory {
    
    @Value("${cache.type:redis}")
    private String cacheType;
    
    private final RedisTemplate<String, Object> redisTemplate;
    private final HazelcastInstance hazelcastInstance;
    
    public CacheFactory(RedisTemplate<String, Object> redisTemplate, 
                       HazelcastInstance hazelcastInstance) {
        this.redisTemplate = redisTemplate;
        this.hazelcastInstance = hazelcastInstance;
    }
    
    public CacheRepository createCacheRepository() {
        CacheType type = CacheType.fromValue(cacheType);
        
        return switch (type) {
            case REDIS -> new RedisRepository(redisTemplate);
            case HAZELCAST -> new HazelcastRepository(hazelcastInstance);
            case MULTI_LEVEL -> new MultiLevelCacheRepository(
                new HazelcastRepository(hazelcastInstance),
                new RedisRepository(redisTemplate)
            );
        };
    }
}
```

## âœ… êµ¬í˜„ ì½”ë“œ

### 1. ìºì‹œ ì¸í„°í˜ì´ìŠ¤

```java
public interface CacheRepository<K, V> {
    
    V get(K key);
    void put(K key, V value);
    void put(K key, V value, Duration ttl);
    void delete(K key);
    boolean exists(K key);
    
    // í¸ì˜ ë©”ì„œë“œ
    default V getOrDefault(K key, V defaultValue) {
        V value = get(key);
        return value != null ? value : defaultValue;
    }
}
```

### 2. Redis êµ¬í˜„ì²´

```java
@Component
public class RedisRepository<K, V> implements CacheRepository<K, V> {
    
    private final RedisTemplate<K, V> redisTemplate;
    private final Duration defaultTtl = Duration.ofHours(1);
    
    public RedisRepository(RedisTemplate<K, V> redisTemplate) {
        this.redisTemplate = redisTemplate;
    }
    
    @Override
    public V get(K key) {
        return redisTemplate.opsForValue().get(key);
    }
    
    @Override
    public void put(K key, V value) {
        put(key, value, defaultTtl);
    }
    
    @Override
    public void put(K key, V value, Duration ttl) {
        redisTemplate.opsForValue().set(key, value, ttl);
    }
    
    @Override
    public void delete(K key) {
        redisTemplate.delete(key);
    }
    
    @Override
    public boolean exists(K key) {
        return Boolean.TRUE.equals(redisTemplate.hasKey(key));
    }
}
```

### 3. Hazelcast êµ¬í˜„ì²´

```java
@Component
public class HazelcastRepository<K, V> implements CacheRepository<K, V> {
    
    private final IMap<K, V> hazelcastMap;
    private final Duration defaultTtl = Duration.ofHours(1);
    
    public HazelcastRepository(HazelcastInstance hazelcastInstance) {
        this.hazelcastMap = hazelcastInstance.getMap("cache");
    }
    
    @Override
    public V get(K key) {
        return hazelcastMap.get(key);
    }
    
    @Override
    public void put(K key, V value) {
        put(key, value, defaultTtl);
    }
    
    @Override
    public void put(K key, V value, Duration ttl) {
        hazelcastMap.put(key, value, ttl.toMillis(), TimeUnit.MILLISECONDS);
    }
    
    @Override
    public void delete(K key) {
        hazelcastMap.remove(key);
    }
    
    @Override
    public boolean exists(K key) {
        return hazelcastMap.containsKey(key);
    }
}
```

### 4. ë©€í‹°ë ˆë²¨ ìºì‹œ êµ¬í˜„

```java
@Component
public class MultiLevelCacheRepository<K, V> implements CacheRepository<K, V> {
    
    private final CacheRepository<K, V> l1Cache; // Hazelcast (ë¹ ë¦„)
    private final CacheRepository<K, V> l2Cache; // Redis (ëŠë¦¼)
    
    public MultiLevelCacheRepository(CacheRepository<K, V> l1Cache, 
                                   CacheRepository<K, V> l2Cache) {
        this.l1Cache = l1Cache;
        this.l2Cache = l2Cache;
    }
    
    @Override
    public V get(K key) {
        // L1 ìºì‹œì—ì„œ ë¨¼ì € ì°¾ê¸°
        V value = l1Cache.get(key);
        if (value != null) {
            return value;
        }
        
        // L2 ìºì‹œì—ì„œ ì°¾ê¸°
        value = l2Cache.get(key);
        if (value != null) {
            // L1ì— ë³µì‚¬í•´ì„œ ë‹¤ìŒë²ˆì—” ë¹ ë¥´ê²Œ ì¡°íšŒ
            l1Cache.put(key, value, Duration.ofMinutes(30));
        }
        
        return value;
    }
    
    @Override
    public void put(K key, V value) {
        // ë‘ ìºì‹œ ëª¨ë‘ì— ì €ì¥
        l1Cache.put(key, value);
        l2Cache.put(key, value);
    }
    
    @Override
    public void put(K key, V value, Duration ttl) {
        l1Cache.put(key, value, ttl);
        l2Cache.put(key, value, ttl);
    }
    
    @Override
    public void delete(K key) {
        l1Cache.delete(key);
        l2Cache.delete(key);
    }
    
    @Override
    public boolean exists(K key) {
        return l1Cache.exists(key) || l2Cache.exists(key);
    }
}
```

### 5. ì„¤ì • íŒŒì¼

```yaml
# application.yml
cache:
  type: redis  # redis, hazelcast, multi

spring:
  data:
    redis:
      host: localhost
      port: 6379
      timeout: 2000ms
      
hazelcast:
  config: classpath:hazelcast.xml
```

### 6. ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ê¸°

```java
@Service
public class UserService {
    
    private final CacheRepository<String, User> cacheRepository;
    private final UserRepository userRepository;
    
    public UserService(CacheFactory cacheFactory, UserRepository userRepository) {
        this.cacheRepository = cacheFactory.createCacheRepository();
        this.userRepository = userRepository;
    }
    
    public User getUser(String userId) {
        // ìºì‹œì—ì„œ ë¨¼ì € ì¡°íšŒ
        User user = cacheRepository.get("user:" + userId);
        if (user != null) {
            return user;
        }
        
        // DBì—ì„œ ì¡°íšŒ í›„ ìºì‹œì— ì €ì¥
        user = userRepository.findById(userId);
        if (user != null) {
            cacheRepository.put("user:" + userId, user, Duration.ofMinutes(10));
        }
        
        return user;
    }
    
    public void updateUser(User user) {
        userRepository.save(user);
        // ìºì‹œ ë¬´íš¨í™”
        cacheRepository.delete("user:" + user.getId());
    }
}
```

## ğŸ“Š í…ŒìŠ¤íŠ¸ ë° ì„±ê³¼

### 1. ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

```java
@SpringBootTest
class CacheRepositoryTest {
    
    @Autowired
    private CacheFactory cacheFactory;
    
    @Test
    void Redis_ìºì‹œ_ê¸°ë³¸_ë™ì‘_í…ŒìŠ¤íŠ¸() {
        // given
        CacheRepository<String, String> cache = cacheFactory.createCacheRepository();
        
        // when
        cache.put("test", "value");
        String result = cache.get("test");
        
        // then
        assertThat(result).isEqualTo("value");
    }
    
    @Test
    void ë©€í‹°ë ˆë²¨_ìºì‹œ_ë™ì‘_í…ŒìŠ¤íŠ¸() {
        // given
        CacheRepository<String, String> cache = cacheFactory.createCacheRepository();
        
        // when
        cache.put("test", "value");
        cache.delete("test"); // L1ì—ì„œë§Œ ì‚­ì œë¨
        String result = cache.get("test"); // L2ì—ì„œ ì¡°íšŒ í›„ L1ì— ë³µì‚¬
        
        // then
        assertThat(result).isEqualTo("value");
    }
}
```

### 2. ì„±ëŠ¥ ë¹„êµ (ê°„ë‹¨í•œ ë¶€í•˜ í…ŒìŠ¤íŠ¸)

```java
@Component
public class CachePerformanceTest {
    
    public void simplePerformanceTest() {
        int iterations = 10000;
        
        // Redis ë‹¨ë… í…ŒìŠ¤íŠ¸
        long redisTime = measureTime(() -> {
            for (int i = 0; i < iterations; i++) {
                redisCache.get("key" + i);
            }
        });
        
        // ë©€í‹°ë ˆë²¨ ìºì‹œ í…ŒìŠ¤íŠ¸
        long multiTime = measureTime(() -> {
            for (int i = 0; i < iterations; i++) {
                multiCache.get("key" + i);
            }
        });
        
        System.out.println("Redis: " + redisTime + "ms");
        System.out.println("Multi: " + multiTime + "ms");
    }
    
    private long measureTime(Runnable task) {
        long start = System.currentTimeMillis();
        task.run();
        return System.currentTimeMillis() - start;
    }
}
```

### 3. ì‹¤ì œ í”„ë¡œì íŠ¸ ì ìš© ê²°ê³¼

- **ê°œë°œ í¸ì˜ì„±**: ì„¤ì • íŒŒì¼ í•œ ì¤„ë§Œ ë°”ê¿”ì„œ ìºì‹œ ì—”ì§„ ì „í™˜ ê°€ëŠ¥
- **ì½”ë“œ ì¬ì‚¬ìš©ì„±**: ìºì‹œ ë¡œì§ì„ í•œ ë²ˆë§Œ ì‘ì„±í•˜ë©´ ì—¬ëŸ¬ ì„œë¹„ìŠ¤ì—ì„œ ì¬ì‚¬ìš©
- **í…ŒìŠ¤íŠ¸ ìš©ì´ì„±**: ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ Mock ê°ì²´ ìƒì„±ì´ ì‰¬ì›Œì§
- **ì„±ëŠ¥ ê°œì„ **: ë©€í‹°ë ˆë²¨ ìºì‹œë¡œ ìì£¼ ì‚¬ìš©ë˜ëŠ” ë°ì´í„°ì˜ ì‘ë‹µ ì†ë„ í–¥ìƒ

## ğŸ“ˆ ì£¼ìš” ì„±ê³¼

### 1. ê°œë°œ íš¨ìœ¨ì„± í–¥ìƒ
- **ì„¤ì • ë³€ê²½ë§Œìœ¼ë¡œ ìºì‹œ ì—”ì§„ ì „í™˜**: Redis â†’ Hazelcast â†’ ë©€í‹°ë ˆë²¨ ìºì‹œë¡œ ì†ì‰¬ìš´ ì „í™˜
- **ì½”ë“œ ì¬ì‚¬ìš©ì„±**: í•œ ë²ˆ ì‘ì„±í•œ ìºì‹œ ë¡œì§ì„ ì—¬ëŸ¬ ì„œë¹„ìŠ¤ì—ì„œ ì¬ì‚¬ìš©
- **í…ŒìŠ¤íŠ¸ í¸ì˜ì„±**: ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ Mock ê°ì²´ ìƒì„±ì´ ì‰¬ì›Œì§

### 2. ìœ ì§€ë³´ìˆ˜ì„± ê°œì„ 
- **ì˜ì¡´ì„± ë¶„ë¦¬**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ìºì‹œ ë¡œì§ì˜ ì™„ì „í•œ ë¶„ë¦¬
- **í™•ì¥ì„±**: ìƒˆë¡œìš´ ìºì‹œ ì—”ì§„ ì¶”ê°€ ì‹œ ì¸í„°í˜ì´ìŠ¤ë§Œ êµ¬í˜„í•˜ë©´ ë¨
- **ë””ë²„ê¹… ìš©ì´ì„±**: ìºì‹œ ë¬¸ì œì™€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¬¸ì œë¥¼ êµ¬ë¶„í•˜ê¸° ì‰¬ì›€

### 3. ì„±ëŠ¥ ê°œì„  íš¨ê³¼
- **ì‘ë‹µ ì‹œê°„ ë‹¨ì¶•**: ë©€í‹°ë ˆë²¨ ìºì‹œë¡œ ìì£¼ ì‚¬ìš©ë˜ëŠ” ë°ì´í„°ì˜ ë¹ ë¥¸ ì¡°íšŒ
- **ìºì‹œ íˆíŠ¸ìœ¨ í–¥ìƒ**: L1 ìºì‹œ ë¯¸ìŠ¤ ì‹œ L2 ìºì‹œì—ì„œ ìë™ ì¡°íšŒ
- **ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±**: ê° ìºì‹œ ì—”ì§„ì˜ ì¥ì ì„ ìƒí™©ì— ë§ê²Œ í™œìš©

íŒ©í† ë¦¬ì™€ í”„ë¡ì‹œ íŒ¨í„´ì„ í™œìš©í•œ ìºì‹œ ì¶”ìƒí™” ë ˆì´ì–´ë¥¼ í†µí•´ ìœ ì—°í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ ìºì‹œ ì‹œìŠ¤í…œì˜ ê¸°ì´ˆë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. íŠ¹íˆ ë©€í‹°ëª¨ë“ˆ í”„ë¡œì íŠ¸ì—ì„œ ê° ëª¨ë“ˆì´ ë™ì¼í•œ ìºì‹œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ì„œë„ í•„ìš”ì— ë”°ë¼ ë‹¤ë¥¸ ìºì‹œ ì—”ì§„ì„ ì„ íƒí•  ìˆ˜ ìˆì–´ ê°œë°œ ìƒì‚°ì„±ì´ í¬ê²Œ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.

## ë‹¤ìŒ ê¸€ ì˜ˆê³ 

2ë¶€ì—ì„œëŠ” ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê³ ê¸‰ ìºì‹œ íŒ¨í„´ë“¤ê³¼ ì„±ëŠ¥ ìµœì í™” ê¸°ë²•ë“¤ì„ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤:

- **DataFetcher íŒ¨í„´**: ìºì‹œ ë¯¸ìŠ¤ ì‹œ ìë™ DB ì¡°íšŒì™€ Cache-Aside íŒ¨í„´ ì™„ì „ ìë™í™”
- **í•˜ì´ë¸Œë¦¬ë“œ ì €ì¥ì†Œ**: Redis + Hazelcast ì¡°í•©ìœ¼ë¡œ ë¹ ë¥¸ ë¡œì»¬ ìºì‹œì™€ ë¶„ì‚° ìºì‹œ ë™ì‹œ í™œìš©
- **Template Method í™œìš©**: BaseCacheServiceë¡œ ëª¨ë“  ìºì‹œ ë¡œì§ í†µì¼í™”
- **ëª¨ë‹ˆí„°ë§ê³¼ ë””ë²„ê¹…**: ìºì‹œ ì„±ëŠ¥ ì¶”ì ê³¼ ì‹¤ì‹œê°„ ìƒíƒœ í™•ì¸ ë°©ë²•
- **ì„±ëŠ¥ íŠœë‹**: ì—°ê²° í’€, ì§ë ¬í™”, TTL ì „ëµ ë“± ì‹¤ë¬´ ìµœì í™” íŒ

ë‹¤ìŒ ê¸€ì—ì„œëŠ” 1ë¶€ì˜ ê¸°ì´ˆ êµ¬ì¡°ë¥¼ ë”ìš± ë°œì „ì‹œì¼œ ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œ ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ê³ ê¸‰ ê¸°ëŠ¥ë“¤ì„ ì†Œê°œí•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

---

*ë³¸ ê¸€ì€ ì‹¤ì œ Spring Boot ë©€í‹°ëª¨ë“ˆ í”„ë¡œì íŠ¸ì—ì„œ ìºì‹œ ì¶”ìƒí™”ë¥¼ ì ìš©í•œ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.*